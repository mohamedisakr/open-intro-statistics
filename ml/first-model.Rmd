---
title: "First Machine Learning Model"
author: "Awesome Me"
date: "2023-05-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## load packages
```{r warning = F}
if(!require("pacman")) install.packages("pacman")
pacman::p_load(
  tidyverse,
  janitor,
  readxl,
  knitr,
  ggplot2,
  lubridate,
  arules,
  arulesViz,
  plyr,
  here,
  conflicted,
  RColorBrewer,
  skimr,
  psych,
  reshape2,
  DataExplorer,
  scales
)

```



## load dataset

```{r}
# https://www.kaggle.com/code/camnugent/introduction-to-machine-learning-in-r-tutorial



# melbourne_data = read_csv(here::here("data", "melb_data.csv")) %>% as_tibble()

# basedir <- here::here()
# basedir

housing = read_csv(here::here("housing.csv")) %>% as_tibble()
# melbourne_data = read_csv(here::here("melb_data.csv")) %>% as_tibble()


```

## inspect dataset structure 

```{r}

housing %>% colnames()  # list of column names
housing %>% nrow()  # how many rows are in data frame?
housing %>% dim()  # dimensions of the data frame?
housing %>% head()  # see the first 6 rows of data frame.  also tail()
housing %>% str()  # see list of columns and data types (numeric, character, etc)
housing %>% summary()  #Statistical summary of data.


```

## examining duplicate records -> for col1, col2, ...

```{r}

duplicated_rows <- housing %>% 
  get_dupes()

duplicated_rows

```


## remove temporary variables 
```{r}

rm(list = grep("^duplicated", ls(), value = TRUE))

```

## checking distinct for the whole df or single column
```{r}

n_distinct(housing) 


```

## checking for NAs
```{r}
sum(is.na(housing))

```

## drop all na values (missing values)
```{r}

housing <- housing %>% drop_na()

```


## convert column data type
```{r}


```

## delete column(s)
```{r}


```



## normalization
```{r}


```


## analyze if there are any correlations between variables
```{r}
# density plot
housing %>% plot_density(ncol = 4, ggtheme = theme_minimal())

# correlation plot
corPlot(housing[, 2:7], upper = FALSE, scale = FALSE, main = "Correlation Sales")

```

## selecting prediction target
```{r}
# y = housing$Price
# y %>% str

```

## selecting features 
```{r}

# housing_features <- c('Rooms', 'Bathroom', 'Landsize', 'Lattitude', 'Longtitude')
# 
# X = housing[housing_features]
# 
# X %>% str()
# 
# X %>% summary()
# 
# X %>% head()

```
```{r}

par(mfrow=c(2,5))

```

```{r}
colnames(housing)

```

```{r}

ggplot(data = melt(housing), mapping = aes(x = value)) + 
    geom_histogram(bins = 30) + facet_wrap(~variable, scales = 'free_x')

```

## fill missing values for total_bedrooms with its median
```{r}

housing$total_bedrooms[is.na(housing$total_bedrooms)] <- 
  median(housing$total_bedrooms , na.rm = TRUE)

sum(is.na(housing$total_bedrooms))

```
## fix the total columns - make them means
```{r}
housing$mean_bedrooms = housing$total_bedrooms/housing$households
housing$mean_rooms = housing$total_rooms/housing$households

drops = c('total_bedrooms', 'total_rooms')

housing = housing[ , !(names(housing) %in% drops)]

```

## list ocean_proximity values
```{r}
housing %>% group_by(ocean_proximity) %>% 
  # dplyr::filter(n() > 1) %>% 
  # na.omit() %>% # drop rows containing missing values
  dplyr::summarize(count = n()) %>% 
  dplyr::arrange(desc(count))

```
## convert char to categorical
```{r}

str(housing$ocean_proximity)

housing <- housing %>% dplyr::mutate(ocean_proximity = as.factor(ocean_proximity))

str(housing$ocean_proximity)

```
## long to wide 
### use pivot_wider converting categorial variables to boolean
```{r}
cat_housing <- housing %>% 
  # select column "ocean_proximity" for cat_housing
    # select(ocean_proximity) %>%
# create columns "val" and "ID" (R needs a unique identifier for an anchor when pivoting)
    dplyr::mutate(val = 1, ID = rownames(.)) %>%
# split variables to columns, replace NA with 0
    pivot_wider(names_from = ocean_proximity, values_from = val,
                values_fill = list(val = 0)) %>%
# drop column "ID"
    select(-ID)

cat_housing %>% colnames()

```

## rename columns name
```{r}

cat_housing <- cat_housing %>% 
  dplyr::rename(near_bay = "NEAR BAY")

cat_housing %>% colnames()

cat_housing %>% str()

```


## scale the numerical variables
```{r}
# drops = c('median_house_value')
# 
# housing_num =  housing[ , !(names(housing) %in% drops)]
# 
# housing_num %>% head()

# housing_num %>% str()


scaled_housing_num = scale(cat_housing)


head(scaled_housing_num)

```





